From stable-bounces@linux.kernel.org Fri Dec 30 22:13:55 2005
Date: Fri, 30 Dec 2005 21:59:41 -0800
Message-Id: <200512310559.jBV5xfr2026442@hera.kernel.org>
From: Linux Kernel Mailing List <linux-kernel@vger.kernel.org>
To: git-commits-head@vger.kernel.org
Cc: 
Subject: sysctl: don't overflow the user-supplied buffer with '0'

tree 2e1aaa5e4e68057a4e96a606e2ad0bcccedcd6df
parent 8b90db0df7187a01fb7177f1f812123138f562cf
author Linus Torvalds <torvalds@g5.osdl.org> Sat, 31 Dec 2005 09:18:53 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> Sat, 31 Dec 2005 09:18:53 -0800

sysctl: don't overflow the user-supplied buffer with '0'

If the string was too long to fit in the user-supplied buffer,
the sysctl layer would zero-terminate it by writing past the
end of the buffer. Don't do that.

Noticed by Yi Yang <yang.y.yi@gmail.com>

Signed-off-by: Linus Torvalds <torvalds@osdl.org>

 kernel/sysctl.c |    4 +---
 1 files changed, 1 insertion(+), 3 deletions(-)

diff --git a/kernel/sysctl.c b/kernel/sysctl.c
index 9990e10..ad0425a 100644
--- a/kernel/sysctl.c
+++ b/kernel/sysctl.c
@@ -2201,14 +2201,12 @@ int sysctl_string(ctl_table *table, int 
 		if (get_user(len, oldlenp))
 			return -EFAULT;
 		if (len) {
-			l = strlen(table->data);
+			l = strlen(table->data)+1;
 			if (len > l) len = l;
 			if (len >= table->maxlen)
 				len = table->maxlen;
 			if(copy_to_user(oldval, table->data, len))
 				return -EFAULT;
-			if(put_user(0, ((char __user *) oldval) + len))
-				return -EFAULT;
 			if(put_user(len, oldlenp))
 				return -EFAULT;
 		}
-
To unsubscribe from this list: send the line "unsubscribe git-commits-head" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html

_______________________________________________
stable mailing list
stable@linux.kernel.org
http://linux.kernel.org/mailman/listinfo/stable

